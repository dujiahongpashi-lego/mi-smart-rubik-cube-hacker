## 动因

我经营轰趴馆的时候，最主要的工作内容其实是打扫卫生。

哈哈，说自己是个清洁工也不过分。

因为顾客退场后的清洁工作，包括场地设施还原，是我工作量最大的工作内容。

其中就包括一项：还原顾客打乱的魔方。

#### 这每次都要花费我好长时间。

其实这属于自己给自己挖的坑，因为我提供了5个不同的魔方，作为娱乐的设施项目之一。

提供的数量好像多了一点，是吧？

然后，由于这玩意的上手实在太简单了，谁都可以来拧两下。所以经常被顾客拧乱。

而我清洁打扫的时候，物品和设施要归位和还原。

于是每次都要对着魔方是说明书，把多达5个魔方拧回初始态。

我觉得这真是有点痛苦的工作。

#### 为啥我没学会拧魔方？

我也不知道，我记得我以前还是会的。后来发现居然忘了，而且再也学不会了，只能看说明书。也是服了我自己，蠢到家。

这是我萌生做一个乐高魔方机器人来玩玩的动因。

当时就只是想玩玩，也没打算说这玩意儿能加快我的工作节奏啥的，没什么指望。

视频中用到的，大神的MindCuber-RI还算是扫描和还原都做的相当快的一个机器人了，其实网上更多的作品，还原都非常慢。

尤其是扫描，更慢。

我真的觉得无法接受，不知道你们有没有这种感觉？就是，这本应该是一个非常聪明的机器人，

#### 结果，它让我觉得非常的傻X

就因为这个扫描环节！

我指望它像Alpha狗一样，用围棋击败人类，额，用拧魔方来击败我。它的核心算法，应该是精妙的魔方解法。

结果，上来一波扫描，我看它活生生像个智障一样。

受不了，受不了！

你们看过速拧比赛的录像没有？

5秒钟一个魔方，手速快到看不清。

每种魔方的打乱态，选手都有最优公式来还原它。记忆力和手速的双重考验。每秒钟都是Amazing。

但是但是，唉。。。同样也是寻求最优公式最优解，这个机器人，我是接受不了。

#### 说实在的，大神的MindCuber-RI扫描算法其实很吊

我简单读了一下代码，没有理解具体的方法，但是他的容错非常高，即使是传感器回传的颜色非常不准，甚至还有识别错误，而就是在这种情况下，它也能非常准确地判断出魔方的状态。

牛的，牛的！

虽然，但是。。。

我还是想把这个环节干掉！

## 小米魔方

我买它之前，其实是犹豫的，

网上关于这魔方的资料太少了。

魔法上网，发现国外有些大佬几年前连接过计客魔方，也是小米生态链产品。

而我也没玩过蓝牙协议啥的。

就硬着头皮上呗，想要不扫描，只能只连到这种自己知道状态的智能魔方，黑进去读数据。

买来小米智能魔方以后，我做了很多代码开发工作，一个多星期没干别的，各种蓝牙相关代码开发和测试。

反正就像你们在视频里看到的一样，我拿到了魔方的数据。

那个时候我觉得已经完成80%了，就差数据解析了。。。

#### 但是当我发现数据是随机的时候，真的崩溃

有那么一瞬间，我想是不是就算了？把已经写好的代码提交就完了，为开源社区做点贡献。

在提交之前，想了想如何给项目起名，写描述和关键词什么的。

于是我把我想到的，在GitHub上先搜了一下。。。

#### 好巧！

真的感谢大神！[链接在这里](https://github.com/wachino/xiaomi-mi-smart-rubik-cube) ，[和这里](https://medium.com/@juananclaramunt/xiaomi-mi-smart-rubik-cube-ff5a22549f90)

通过他的博客，我了解了他做的事，他和我一样，买了这个来自中国的智能魔方，并且同样想黑进去，而且同样遇到了数据随机的问题

但是，他说“Given that, I decided to move to the next step: unpackage the official application without going crazy.”----“我要在不发疯的情况下，破解官方的APP”

看到这句话，我直接就乐的笑出来了

我太理解他了，我觉得我是世界上唯一一个理解他心情的人。

#### 同时，真的佩服大神

能想到反编译官方APP这个思路本身就很厉害，而且，你并不知道你反编译后能得到什么样的Java代码

数据既然可以做混淆，那APP同样可以混淆，额，就是说：反"反编译"

然而，大神就是大神，最后还是做到了！

难点在我看来有两个：
- 读懂并找到对应的代码
- 找到并读懂混淆和逆运算的逻辑

果不其然，大神也说“So just right before I was about to go mad, I discovered a piece of code...”----“还好我在抓狂之前找到了一段代码...”

可想而知他的内心也曾经是绝望的

## 只剩最后的工作

#### 是的，大神成功后还做了一个工作

他把破解出来的逆运算解法，翻译了一遍。

把Java翻译成了JavaScript，并且公开了。

感谢大神！

魔方有6x9=54个色块，要知道，在执行逆运算的过程中，每个色块都要仔细的进行对应，而且还要映射到真实魔方的空间位置上。这非常的麻烦。

而我验证过后，它运行的很完美。

#### 于是我也做了同样的工作

我把JavaScript又翻译成了Python

这是为了让这段算法可以工作在乐高上

感谢大神，有了这段代码，乐高小米魔方机器人的完成度达到了100%，我也顺利完成了开发。于是才能有这个视频。

### 最后，你们可以在我提供的链接中看到大神的代码，而且Python版的部分也可以在这个项目的代码里找到。
### 这篇长文感谢你能看到这里，下期视频咱们再见！